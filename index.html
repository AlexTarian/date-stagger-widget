<!doctype html>
<html>
  <head>
    <script src="//js.jotform.com/JotFormCustomWidget.min.js"></script>
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="pragma" content="no-cache" />
  </head>
  <style></style>
  <body>
    <div id="reviewArea">
      <div>Version 9 </div>
      <div>Start Date: <span id="ui-start">—</span></div>
      <div>End Date: <span id="ui-end">—</span></div>
      <div>Workers: <span id="ui-workers">—</span></div>
    </div>
    <script type="text/javascript">
      function tableExampleForCleaningDepot() {
        const start = JFCustomWidget.getWidgetSetting('startFieldId');
        const end = JFCustomWidget.getWidgetSetting('endFieldId');
        const workers = JFCustomWidget.getWidgetSetting('totalWorkersFieldId');

        console.log(`start param: ${start}`)
        console.log(`end param: ${end}`)
        console.log(`workers param: ${workers}`)

        // exposed functions
        this.init = init;
        this.getData = getData;
        const otherFields = [
          'startDate',
          'endDate',
          'h2aWorkers'
        ]

        function getFieldsByX(){
          console.log("Running getFieldsByX")
          JFCustomWidget.getFieldsValueByName(otherFields, function(res){
              setTimeout(console.log(`Here's the data ${JSON.stringify(res, null, 2)}`), 500)
          })
        }

        function getStartDate(){
          console.log(JFCustomWidget.getFieldsValueById(start));
        }
        function getEndDate(){
          console.log(JFCustomWidget.getFieldsValueById(end), (map) => {
          });
        }
        function getWorkers(){
          console.log(JFCustomWidget.getFieldsValueById(workers));
        }

        // initialization of the widget
        function init(formData) {
          console.log("Hello world!");
          getFieldsByX();
          getStartDate();
          getEndDate();
          getWorkers();
        }

        // get widget data
        function getData() {
          return {
            valid: true,
            value: "TEST"
          };
        }
      }

      // always subscribe to ready event and implement widget related code
      // inside callback function , it is the best practice while developing widgets
      JFCustomWidget.subscribe("ready", function () {
        const unwrap = v => (v && typeof v === 'object' && 'value' in v) ? v.value : v;
        const qid = key => String(JFCustomWidget.getWidgetSetting(key) || '').replace(/^input_/, '');
      
        const sQ = qid('startFieldId');
        const eQ = qid('endFieldId');
        const nQ = qid('totalWorkersFieldId');
      
        // Initial pull
        JFCustomWidget.getFieldsValueById([sQ, eQ, nQ], (map) => {
          const unwrap = v => (v && typeof v === 'object' && 'value' in v) ? v.value : v;
        
          const startDate    = unwrap(map[sQ]) || '';
          const endDate      = unwrap(map[eQ]) || '';
          const totalWorkers = Number(unwrap(map[nQ]) || 0);
        
          updateReviewArea({ startDate, endDate, totalWorkers }); // <-- update UI
          applyHostValues({ startDate, endDate, totalWorkers });  // <-- your widget state
          pushValue(validate().length === 0);                     // <-- send to Jotform
        });
        
        // Live updates
        const listenQID = (q, h) => {
          const id = 'input_' + q;
          try { JFCustomWidget.listenFromField(id, 'change', h); } catch(_){}
          try { JFCustomWidget.listenFromField(id, 'keyup',  h); } catch(_){}
        };
        listenQID(sQ, (v)=> { updateReviewArea({ startDate: v });    setBounds({ startDate: v }); });
        listenQID(eQ, (v)=> { updateReviewArea({ endDate: v });      setBounds({ endDate: v }); });
        listenQID(nQ, (v)=> { const n = Number(v)||0; updateReviewArea({ totalWorkers: n }); setBounds({ totalWorkers: n }); });
      
        // Submit hook
        JFCustomWidget.subscribe('submit', function(){
          const errs = validate();
          JFCustomWidget.sendSubmit({ valid: errs.length===0, value: JSON.stringify(serialize()) });
        });
      });

    </script>
  </body>
</html>










